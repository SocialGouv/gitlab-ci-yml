#

.base_create_namespace_stage:
  extends: .base_docker_kubectl_image_stage
  stage: "Registration"
  environment:
    name: factory-dev
  dependencies: []
  script:
    # Skip the job if the namespace exists
    - "[[ $(kubectl get namespace ${K8S_NAMESPACE}) ]] && exit ${CI_JOB_SKIP_EXIT_CODE:-0}"
    #
    - kubectl create namespace ${K8S_NAMESPACE}
    - kubectl annotate namespace ${K8S_NAMESPACE} field.cattle.io/projectId=${RANCHER_PROJECT_ID}
    - kubectl label ns ${K8S_NAMESPACE} cert=wildcard --overwrite
    #
    # Fake rancher namespace creation
    - kubectl annotate namespace ${K8S_NAMESPACE} field.cattle.io/creatorId=gitlab
    - kubectl label namespace ${K8S_NAMESPACE} git/branch=${CI_COMMIT_REF_NAME}
